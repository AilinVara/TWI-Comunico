<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ejercicio</title>

    <link rel="icon" th:href="@{/img/icon.svg}" type="image/x-icon">
    <link rel="stylesheet" th:href="@{/css/ejercicio.css}" />
    <link rel="stylesheet" th:href="@{/css/header.css}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div th:replace="header :: header"></div>

<div class="barra-experiencia">
    <div class="experiencia-llena" th:style="'width: ' + (${experiencia} / ${experienciaMaxima} * 100) + '%'">
        <p><span th:text="${experiencia}" id="experiencia">0</span>/<span th:text="${experienciaMaxima}">0</span>XP</p>
    </div>
</div>



<div class="titulo">
    <h3>Ejercicio con video</h3>
</div>

<div class="game-container">
    <div class="question">
        <p id="braille-letter">Ejercicio 1</p>
    </div>


    <div class="sign-video">
        <img class="video" th:src="@{https://diccionariolsc.ces.edu.co/wp-content/uploads/sites/3/2022/05/B_Frontal.gif}" alt="Muestra">

        <form th:action="@{'/resolver/' + ${indice}}" method="post" th:object="${ejercicio}">
            <input hidden th:name="ejercicioId" th:value="${ejercicio.getId()}">
            <input hidden name="leccion" th:value="${leccion}">
            <div class="radioYFrases">
                <div class="OpcionesFrase" th:each="opcion: ${ejercicio.opcionesIncorrectas}">
                    <input class="option optionVideo" type="radio" th:id="'opcion_' + ${opcion.id}" name="respuesta" th:value="${opcion.id}"/>
                    <label class="optionFrase" th:for="'opcion_' + ${opcion.id}" th:text="${opcion.descripcion}">-</label>
                </div>

                <div class="OpcionesFrase">
                    <input class="option optionVideo" type="radio" id="opcionCorrecta" name="respuesta"
                           th:value="${ejercicio.opcionCorrecta.id}"/>
                    <label class="optionFrase" th:for="opcionCorrecta"
                           th:text="${ejercicio.opcionCorrecta.descripcion}">-</label>
                </div>
            </div>

            <button class="enviar enviar-ejercicioVideo" type="submit">Enviar</button>
        </form>
    </div>

    <div th:if="${esCorrecta != null}">
        <script th:inline="javascript">
            let siguienteTexto = [[${indice}]] < 3 ? 'Siguiente ejercicio' : 'Finalizar lección';
            let siguienteUrl = [[${indice}]] < 3 ? '/ejercicio/' + ([[${indice}]] + 1) + '?leccion=' + [[${leccion}]]
                : '/senias';
            let mensaje = [[${esCorrecta}]] ? 'Respuesta correcta' : 'Respuesta incorrecta';

            if (![[${esCorrecta}]]) {
                mensaje += `\n Has perdido una vida <i class="fa-solid fa-heart-crack"></i>`;
                mensaje += `<br>Te quedan [[${vidas}]] vidas.`;
                mensaje += `<br>Tiempo restante para la próxima vida: <i class="fa-solid fa-clock-rotate-left"></i> [[${tiempoRestante}]] minutos.`;
            }
            Swal.fire({
                icon: [[${esCorrecta}]] ? 'success' : 'error',
                title: [[${esCorrecta}]] ? '¡Correcto!' : '¡Incorrecto!',
                html: mensaje,
                confirmButtonColor: [[${esCorrecta}]] ? '#4CAF50' : '#f44336',
                confirmButtonText: siguienteTexto
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = siguienteUrl;
                }
            });
        </script>


    </div>
</div>
<script th:inline="javascript">
    function actualizarExperiencia(experiencia) {
        const barra = document.querySelector('.experiencia-llena');
        const porcentaje = (experiencia / 5000) * 100;
        barra.style.width = porcentaje + '%';
        barra.style.backgroundColor = '#4caf50';  // Color de la barra cuando se llena
    }

    actualizarExperiencia([[${experiencia}]]);
</script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>
